Preparing data loaders...
Initializing model...
2025-12-06 18:06:51,522 - INFO - Start training for 20 epochs on mps...
Epoch 1 [Train]:   0%|                                                                  | 0/34 [00:00<?, ?it/s]/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/utils/data/dataloader.py:692: UserWarning: 'pin_memory' argument is set as true but not supported on MPS now, device pinned memory won't be used.
  warnings.warn(warn_msg)
Traceback (most recent call last):                                                                             
  File "/Users/wadarei/2WINS_AI_test/main.py", line 113, in <module>
    main()
    ~~~~^^
  File "/Users/wadarei/2WINS_AI_test/main.py", line 107, in main
    trainer.fit(num_epochs=cfg.epochs)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/wadarei/2WINS_AI_test/src/trainer.py", line 161, in fit
    train_loss = self.train_one_epoch(epoch)
  File "/Users/wadarei/2WINS_AI_test/src/trainer.py", line 84, in train_one_epoch
    outputs = self.model(images)
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/wadarei/2WINS_AI_test/src/models.py", line 59, in forward
    return self.model(x)
           ~~~~~~~~~~^^^
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torchvision/models/resnet.py", line 285, in forward
    return self._forward_impl(x)
           ~~~~~~~~~~~~~~~~~~^^^
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torchvision/models/resnet.py", line 275, in _forward_impl
    x = self.layer3(x)
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/container.py", line 250, in forward
    input = module(input)
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torchvision/models/resnet.py", line 97, in forward
    out = self.bn2(out)
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/modules/batchnorm.py", line 193, in forward
    return F.batch_norm(
           ~~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<11 lines>...
        self.eps,
        ^^^^^^^^^
    )
    ^
  File "/Users/wadarei/2WINS_AI_test/.venv/lib/python3.13/site-packages/torch/nn/functional.py", line 2813, in batch_norm
    return torch.batch_norm(
           ~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<7 lines>...
        torch.backends.cudnn.enabled,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
RuntimeError: MPS backend out of memory (MPS allocated: 8.45 GiB, other allocations: 514.67 MiB, max allowed: 9.07 GiB). Tried to allocate 128.00 MiB on private pool. Use PYTORCH_MPS_HIGH_WATERMARK_RATIO=0.0 to disable upper limit for memory allocations (may cause system failure).
